{%- comment -%}
if (Shopify.Checkout.step == 'contact_information'){
	...
}
{%- endcomment -%}
{%- comment -%}
	Cómo armar un url de checkout, falta el checkout_id o checkoutToken
	'{{ shop.secure_url }}\/10992810\/checkouts\/{{}}\/contact_information'
	Shopify.ClientAttributesCollection.checkoutToken es el token del checkout
{%- endcomment -%}


{%- comment -%}
Abril 2021
https://flintanalytics.com/installing-enhanced-ecommerce-using-google-tag-manager-and-the-data-layer/
Y aquí los ejemplos: https://enhancedecommerce.appspot.com/checkout
{%- endcomment -%}



{% comment %} {% if template == 'index' %}
	<script>
	window.dataLayer = window.dataLayer || [];
	window.dataLayer.push({
		'URL': "{{ canonical_url }}"
	});
	//console.log('DL template index');
	//console.log('dataLayer', JSON.stringify(dataLayer, null, 0));
	</script>
{% endif %} {% endcomment %}

{% comment %} {% if page.url contains 'pages' %}
	<script>
	window.dataLayer = window.dataLayer || [];
	window.dataLayer.push({
		'pageCategory': '{{ handle }}',
		'URL': '{{ canonical_url }}'
	});
	//console.log('DL pages');
	//console.log('dataLayer', JSON.stringify(dataLayer, null, 0));
	</script>
{% endif %} {% endcomment %}

{% comment %} {% if template == 'collection' %}
	<script>
	window.dataLayer = window.dataLayer || [];
	window.dataLayer.push({
		'pageCategory': '{{ collection.title }}',
		'URL': '{{ canonical_url }}'
	});
	//console.log(dataLayer);
	//console.log('DL collections');
	</script>
{% endif %} {% endcomment %}

{% comment %} {% if product.url contains 'products' %}
{%- assign current_variant = product.selected_or_first_available_variant -%}
	<script>
	window.dataLayer = window.dataLayer || [];
	window.dataLayer.push({
		'pageCategory': '{{ product.type }}',
		'productBrand': '{{ product.vendor }}',
		'productName': '{{ product.title }}',
		'productPrice': {{ product.price | times: 0.01 }},
		'productSKU': '{{ current_variant.sku }}',
		'URL': '{{ canonical_url }}'
	});
	//console.log('DL products');
	//console.log('dataLayer', JSON.stringify(dataLayer, null, 0));
	</script>
{% endif %} {% endcomment %}

{% comment %} {% if template == 'cart' %}
	<script>
		window.dataLayer = window.dataLayer || [];
		window.dataLayer.push({
			'cartSubtotal': {{ cart.original_total_price | times: 0.01 }},
			'currency': '{{ shop.currency }}',
			'pageCategory': '{{ template.name }}',
			'products': [
						{% for item in cart.items %}
						{
							'productName': '{{item.title}}',
							'productPrice': {{item.line_price | times: 0.01}},
							'productSKU': '{{item.variant.sku}}',
							'pageCategory': '{{item.product.type}}',
							'productBrand': '{{item.vendor}}'
						},
						{% endfor %}
					],
			'quantity': {{ cart.item_count }},
			'totalPurchase': {{ cart.total_price | times: 0.01 }},
			'URL': '{{ canonical_url }}'
		});
		//console.log('DL cart');
		//console.log('dataLayer', JSON.stringify(dataLayer, null, 0));
	</script>
{% endif %} {% endcomment %}

{% if checkout %}
	{% if content_for_layout contains 'data-step="contact_information"' %}
		<script>
			const currentURL = window.location.href;
			window.dataLayer = window.dataLayer || [];
			window.dataLayer.push({
				'pageCategory': 'contact_information',
				'URL': `${currentURL}`
			});
			//console.log('contact_information step');
			//console.log('dataLayer', JSON.stringify(dataLayer, null, 0));
		</script> 
	{% elsif content_for_layout contains 'data-step="shipping_method"' %}
		<script>
			const currentURL = window.location.href;
			window.dataLayer = window.dataLayer || [];
			window.dataLayer.push({
				'pageCategory': 'shipping_method',
				'URL': `${currentURL}`
			});
			//console.log('shipping_method step');
			//console.log('dataLayer', JSON.stringify(dataLayer, null, 0));
		</script>
	{% elsif content_for_layout contains 'data-step="payment_method"' %}
		<script>	
			const currentURL = window.location.href;
			window.dataLayer = window.dataLayer || [];
			window.dataLayer.push({
				'pageCategory': 'payment_method',
				'paymentMethod': 'not available',
				'URL': `${currentURL}`
			});
			//console.log('payment_method step');
			//console.log('dataLayer', JSON.stringify(dataLayer, null, 0));
		</script>
	{% elsif content_for_layout contains 'thank_you' or content_for_layout contains 'thank-you' %}
		<script>
			const currentURL = window.location.href;
			window.dataLayer = window.dataLayer || [];
			window.dataLayer.push({
				'event': 'purchase',
				'ecommerce': {
					'cartSubtotal': '{{ order.line_items_subtotal_price | times: 0.01  }}',
					'currency': '{{ checkout.currency }}',
					'items': [
								{% for line_item in order.line_items %}
								{
									'pageCategory': '{{line_item.product.type}}',
									'productBrand': '{{line_item.vendor}}',
									'productID': '{{line_item.variant.id}}',
									'productName': '{{line_item.title}}',
									'productPrice': '{{line_item.line_price | times: 0.01}}',
									'productSKU': '{{line_item.variant.sku}}',
									'productVariant': '{{line_item.variant.title}}',
									'productQty': '{{line_item.quantity}}'
								},
								{% endfor %}
								],
					'orderID': '{{ order.name }}',
					'pageCategory': 'thank_you',
					'paymentMethod': [
						{% for transaction in order.transactions %}
							{
								'paymentMethod': '{{ transaction.gateway }}'
							},
						{% endfor %}
						],
					'quantity': '{{ order.line_items | size }}',
					'totalPurchase': '{{ order.total_price | times: 0.01  }}',
					'URL': `${currentURL}`
				}
			});
			console.log('thank_you step');
			console.log('dataLayer', JSON.stringify(dataLayer, null, 0));
		</script>
	{% endif %}
{% endif %}

{% comment %} <script>

window.addEventListener('DOMContentLoaded', (event) => {
	//const addToCartButtons = document.querySelectorAll('#AddToCart');
	const addToCartButtons = document.querySelectorAll('button.add-to-cart');
	function dlAddToCart() {
		console.log('datalayerrrr');
	}
	addToCartButtons.forEach(function(addToCartButton) {
		console.log('button click');
		addToCartButton.addEventListener('click', dlAddToCart);
	});
});

// #AddToCart (regular product page & sundae product page)
// .button-add 
// .btn__agregar (eye shine landing)
// .btn__midabi (momiji life landing)
// .lion-redeem-reward-modal__button--confirm (loyalty lion confirm dialog)
// add-to-cart (current sundae landing)

</script> {% endcomment %}